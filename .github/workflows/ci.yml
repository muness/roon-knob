name: CI

on:
  push: {}
  pull_request: {}

jobs:
  build-pc:
    name: Build PC Simulator
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          brew install cmake ninja sdl2 curl
      - name: Configure & build
        run: |
          cmake -S pc_sim -B build/pc_sim -G Ninja
          cmake --build build/pc_sim
      - name: JSON unit test
        run: python tests/test_json_parse.py

  build-idf:
    name: Build ESP-IDF Firmware
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ESP-IDF
        uses: espressif/actions/setup-esp-idf@v2
        with:
          esp_idf_version: release/v5.2
      - name: Build IDF app
        run: |
          cd idf_app
          idf.py build
      - name: Upload firmware artifact
        uses: actions/upload-artifact@v4
        with:
          name: firmware
          path: idf_app/build/roon_knob.bin
          retention-days: 30
